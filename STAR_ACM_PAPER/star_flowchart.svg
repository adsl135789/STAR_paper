<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg">
  <!-- Define styles -->
  <defs>
    <style>
      .module-box { fill: #4A90E2; stroke: #2E5C8A; stroke-width: 2; }
      .process-box { fill: #F5F5F5; stroke: #333; stroke-width: 1.5; }
      .data-box { fill: #E8F4F8; stroke: #5DADE2; stroke-width: 1.5; }
      .output-box { fill: #A8E6CF; stroke: #52A67D; stroke-width: 2; }
      .title-text { font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; fill: #333; }
      .module-text { font-family: Arial, sans-serif; font-size: 13px; font-weight: bold; fill: white; }
      .normal-text { font-family: Arial, sans-serif; font-size: 11px; fill: #333; }
      .small-text { font-family: Arial, sans-serif; font-size: 10px; fill: #555; }
      .arrow { stroke: #333; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .dashed-arrow { stroke: #666; stroke-width: 1.5; fill: none; stroke-dasharray: 5,3; marker-end: url(#arrowhead-light); }
    </style>

    <!-- Arrow markers -->
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333" />
    </marker>
    <marker id="arrowhead-light" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#666" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="400" y="25" text-anchor="middle" class="title-text" font-size="16px">STAR: Semantic Table Aggregation and Representation</text>

  <!-- Input -->
  <rect x="320" y="45" width="160" height="50" class="data-box" rx="5"/>
  <text x="400" y="65" text-anchor="middle" class="normal-text" font-weight="bold">Input</text>
  <text x="400" y="80" text-anchor="middle" class="small-text">Table (Header + Rows)</text>
  <text x="400" y="92" text-anchor="middle" class="small-text">+ User Question</text>

  <!-- Arrow to SCDG -->
  <path d="M 400 95 L 400 120" class="arrow"/>

  <!-- SCDG Module -->
  <rect x="50" y="120" width="700" height="180" class="module-box" rx="8"/>
  <text x="400" y="140" text-anchor="middle" class="module-text" font-size="14px">Module 1: Semantic Clustering and Query Generation (SCDG)</text>

  <!-- Header-aware K-means -->
  <rect x="70" y="155" width="200" height="130" class="process-box" rx="4"/>
  <text x="170" y="172" text-anchor="middle" class="normal-text" font-weight="bold">Header-aware K-means</text>
  <text x="170" y="190" text-anchor="middle" class="small-text">1. Embed header: E_header</text>
  <text x="170" y="205" text-anchor="middle" class="small-text">2. Embed rows: E_row</text>
  <text x="170" y="220" text-anchor="middle" class="small-text">3. Weighted combination:</text>
  <text x="170" y="235" text-anchor="middle" class="small-text" font-style="italic">e_i = α·E_header + (1-α)·E_row</text>
  <text x="170" y="250" text-anchor="middle" class="small-text">(α = 0.2)</text>
  <text x="170" y="265" text-anchor="middle" class="small-text">4. K-means clustering (k=10)</text>
  <text x="170" y="280" text-anchor="middle" class="small-text" font-weight="bold">→ k centroid rows</text>

  <!-- Arrow -->
  <path d="M 270 220 L 310 220" class="arrow"/>

  <!-- Clustering-Guided Query Generation -->
  <rect x="310" y="155" width="200" height="130" class="process-box" rx="4"/>
  <text x="410" y="172" text-anchor="middle" class="normal-text" font-weight="bold">CGQG</text>
  <text x="410" y="187" text-anchor="middle" class="small-text">Clustering-Guided Query</text>
  <text x="410" y="202" text-anchor="middle" class="small-text">Generation</text>
  <text x="410" y="222" text-anchor="middle" class="small-text">For each cluster:</text>
  <text x="410" y="237" text-anchor="middle" class="small-text">Generate synthetic query</text>
  <text x="410" y="252" text-anchor="middle" class="small-text">using Llama 3.1 8B-Instruct</text>
  <text x="410" y="272" text-anchor="middle" class="small-text" font-weight="bold">→ k synthetic queries</text>

  <!-- Arrow -->
  <path d="M 510 220 L 550 220" class="arrow"/>

  <!-- Partial Table output -->
  <rect x="550" y="185" width="180" height="70" class="data-box" rx="4"/>
  <text x="640" y="205" text-anchor="middle" class="normal-text" font-weight="bold">Output:</text>
  <text x="640" y="222" text-anchor="middle" class="small-text">• Partial table (k rows)</text>
  <text x="640" y="237" text-anchor="middle" class="small-text">• k synthetic queries</text>

  <!-- Arrow to WF -->
  <path d="M 640 255 L 640 320" class="arrow"/>

  <!-- WF Module -->
  <rect x="50" y="320" width="700" height="180" class="module-box" rx="8"/>
  <text x="400" y="340" text-anchor="middle" class="module-text" font-size="14px">Module 2: Weighted Fusion (WF)</text>

  <!-- Embedding -->
  <rect x="70" y="355" width="280" height="130" class="process-box" rx="4"/>
  <text x="210" y="372" text-anchor="middle" class="normal-text" font-weight="bold">Embedding Generation</text>
  <text x="210" y="392" text-anchor="middle" class="small-text">1. Embed partial table → E_t</text>
  <text x="210" y="407" text-anchor="middle" class="small-text">2. Embed concat(queries) → E_q</text>
  <text x="210" y="427" text-anchor="middle" class="small-text">3. Apply fusion strategy:</text>
  <text x="210" y="447" text-anchor="middle" class="small-text" font-weight="bold">FWF: E = 0.7·E_t + 0.3·E_q</text>
  <text x="210" y="462" text-anchor="middle" class="small-text" font-weight="bold">DWF: W_q = β·cos(E_t, E_q)</text>
  <text x="210" y="477" text-anchor="middle" class="small-text" font-weight="bold">     E = (1-W_q)·E_t + W_q·E_q</text>

  <!-- Arrow -->
  <path d="M 350 420 L 390 420" class="arrow"/>

  <!-- Final Representation -->
  <rect x="390" y="375" width="320" height="100" class="output-box" rx="4"/>
  <text x="550" y="395" text-anchor="middle" class="normal-text" font-weight="bold" font-size="13px">Final Table Representation</text>
  <text x="550" y="415" text-anchor="middle" class="small-text">Semantically enriched embedding</text>
  <text x="550" y="430" text-anchor="middle" class="small-text">combining table structure and</text>
  <text x="550" y="445" text-anchor="middle" class="small-text">query-relevant information</text>
  <text x="550" y="465" text-anchor="middle" class="small-text" font-weight="bold">→ Used for table retrieval</text>

  <!-- Models used (bottom note) -->
  <rect x="50" y="520" width="700" height="60" fill="#FFF9E6" stroke="#FFD700" stroke-width="1" rx="4"/>
  <text x="400" y="538" text-anchor="middle" class="small-text" font-weight="bold">Key Components:</text>
  <text x="400" y="553" text-anchor="middle" class="small-text">Embedding Model: BGE-M3  |  Query Generation: Llama 3.1 8B-Instruct  |  k = 10  |  α = 0.2  |  β = 0.3</text>
  <text x="400" y="568" text-anchor="middle" class="small-text">Evaluation: Recall@1, Recall@5, Recall@10 on Mimo(ch/en), OTTQA, FetaQA, E2E-WTQ</text>
</svg>
