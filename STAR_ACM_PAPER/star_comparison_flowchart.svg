<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg width="1100" height="600" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font-family: Arial, sans-serif; font-size: 18px; font-weight: bold; fill: #2d3748; }
      .method-title { font-family: Arial, sans-serif; font-size: 15px; font-weight: bold; }
      .label { font-family: Arial, sans-serif; font-size: 12px; font-weight: 600; fill: #2d3748; }
      .small-label { font-family: Arial, sans-serif; font-size: 10px; fill: #4a5568; }
    </style>

    <!-- Arrow markers -->
    <marker id="arrow-qgpt" markerWidth="8" markerHeight="8" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#e53e3e" />
    </marker>
    <marker id="arrow-star" markerWidth="8" markerHeight="8" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#3182ce" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="550" y="25" text-anchor="middle" class="title">Offline Index Stage: QGpT vs STAR</text>

  <!-- ============ Input Table (Shared) ============ -->
  <g transform="translate(30, 60)">
    <rect x="0" y="0" width="100" height="120" rx="6" fill="#edf2f7" stroke="#a0aec0" stroke-width="2"/>
    <text x="50" y="20" text-anchor="middle" class="label">Input Table</text>

    <!-- Simple table grid -->
    <rect x="15" y="30" width="70" height="12" fill="#4299e1" opacity="0.7" rx="2"/>
    <rect x="15" y="45" width="70" height="8" fill="#cbd5e0" rx="1"/>
    <rect x="15" y="56" width="70" height="8" fill="#cbd5e0" rx="1"/>
    <rect x="15" y="67" width="70" height="8" fill="#cbd5e0" rx="1"/>
    <rect x="15" y="78" width="70" height="8" fill="#cbd5e0" rx="1"/>
    <rect x="15" y="89" width="70" height="8" fill="#cbd5e0" rx="1"/>
    <rect x="15" y="100" width="70" height="8" fill="#cbd5e0" rx="1"/>
  </g>

  <!-- Arrows from input -->
  <path d="M 140 90 L 180 90" stroke="#e53e3e" stroke-width="2" fill="none" marker-end="url(#arrow-qgpt)"/>
  <path d="M 140 150 L 180 150" stroke="#3182ce" stroke-width="2" fill="none" marker-end="url(#arrow-star)"/>

  <!-- ============ QGpT Path (Top) ============ -->
  <text x="190" y="75" class="method-title" fill="#e53e3e">QGpT</text>

  <!-- Step 1: Heuristic Cut -->
  <g transform="translate(190, 80)">
    <rect x="0" y="0" width="85" height="70" rx="5" fill="#fff5f5" stroke="#e53e3e" stroke-width="1.5"/>
    <text x="42.5" y="15" text-anchor="middle" class="small-label">Heuristic Cut</text>

    <!-- Table being cut -->
    <rect x="15" y="22" width="55" height="8" fill="#e53e3e" opacity="0.3" rx="1"/>
    <line x1="15" y1="35" x2="70" y2="35" stroke="#e53e3e" stroke-width="1.5" stroke-dasharray="3,2"/>
    <text x="42.5" y="40" text-anchor="middle" style="font-size: 14px;">âœ‚</text>
    <rect x="15" y="45" width="55" height="6" fill="#cbd5e0" opacity="0.4" rx="1"/>
    <rect x="15" y="53" width="55" height="6" fill="#cbd5e0" opacity="0.4" rx="1"/>
    <text x="42.5" y="66" text-anchor="middle" class="small-label">Top-k rows</text>
  </g>

  <path d="M 285 115 L 305 115" stroke="#e53e3e" stroke-width="2" fill="none" marker-end="url(#arrow-qgpt)"/>

  <!-- LLM -->
  <g transform="translate(315, 90)">
    <circle cx="30" cy="25" r="25" fill="#fef5e7" stroke="#f39c12" stroke-width="2"/>
    <text x="30" y="20" text-anchor="middle" style="font-size: 18px;">ðŸ§ </text>
    <text x="30" y="35" text-anchor="middle" class="small-label" font-weight="bold">LLM</text>
  </g>

  <path d="M 375 115 L 395 115" stroke="#e53e3e" stroke-width="2" fill="none" marker-end="url(#arrow-qgpt)"/>

  <!-- Queries -->
  <g transform="translate(405, 95)">
    <rect x="0" y="0" width="50" height="40" rx="4" fill="#fff5f5" stroke="#e53e3e" stroke-width="1.5"/>
    <rect x="8" y="8" width="34" height="6" fill="#e53e3e" opacity="0.6" rx="1"/>
    <rect x="8" y="17" width="34" height="6" fill="#e53e3e" opacity="0.6" rx="1"/>
    <rect x="8" y="26" width="34" height="6" fill="#e53e3e" opacity="0.6" rx="1"/>
  </g>

  <path d="M 465 115 L 490 115" stroke="#e53e3e" stroke-width="2" fill="none" marker-end="url(#arrow-qgpt)"/>

  <!-- Step 2: Concatenate -->
  <g transform="translate(500, 85)">
    <rect x="0" y="0" width="100" height="60" rx="5" fill="#fff5f5" stroke="#e53e3e" stroke-width="1.5"/>
    <text x="50" y="14" text-anchor="middle" class="small-label">Concatenate</text>

    <!-- Visual concat: two boxes merging -->
    <rect x="15" y="22" width="30" height="14" fill="#e53e3e" opacity="0.4" rx="2"/>
    <rect x="55" y="22" width="30" height="14" fill="#e53e3e" opacity="0.4" rx="2"/>
    <text x="50" y="33" text-anchor="middle" style="font-size: 16px; fill: #e53e3e; font-weight: bold;">+</text>
    <rect x="25" y="42" width="50" height="12" fill="#e53e3e" opacity="0.7" rx="2"/>
  </g>

  <path d="M 610 115 L 635 115" stroke="#e53e3e" stroke-width="2" fill="none" marker-end="url(#arrow-qgpt)"/>

  <!-- Encoder -->
  <g transform="translate(645, 95)">
    <rect x="0" y="0" width="70" height="40" rx="5" fill="#fef5e7" stroke="#f39c12" stroke-width="2"/>
    <text x="35" y="15" text-anchor="middle" class="small-label">Encoder</text>
    <circle cx="25" cy="27" r="5" fill="#f39c12" opacity="0.5"/>
    <circle cx="35" cy="27" r="5" fill="#f39c12" opacity="0.7"/>
    <circle cx="45" cy="27" r="5" fill="#f39c12" opacity="0.5"/>
  </g>

  <path d="M 725 115 L 750 115" stroke="#e53e3e" stroke-width="2" fill="none" marker-end="url(#arrow-qgpt)"/>

  <!-- Output -->
  <g transform="translate(760, 100)">
    <ellipse cx="40" cy="15" rx="40" ry="15" fill="#c6f6d5" stroke="#38a169" stroke-width="2"/>
    <text x="40" y="20" text-anchor="middle" class="small-label" font-weight="bold">E_table</text>
  </g>

  <!-- ============ STAR Path (Bottom) ============ -->
  <text x="190" y="335" class="method-title" fill="#3182ce">STAR</text>

  <!-- Step 1a: K-means -->
  <g transform="translate(190, 340)">
    <rect x="0" y="0" width="100" height="80" rx="5" fill="#ebf8ff" stroke="#3182ce" stroke-width="1.5"/>
    <text x="50" y="14" text-anchor="middle" class="small-label">Header-aware</text>
    <text x="50" y="26" text-anchor="middle" class="small-label">K-means</text>

    <!-- Clustering circles - different groups -->
    <g opacity="0.8">
      <circle cx="30" cy="45" r="6" fill="#fbbf24"/>
      <circle cx="42" cy="42" r="6" fill="#fbbf24"/>
      <circle cx="36" cy="56" r="6" fill="#fbbf24"/>

      <circle cx="64" cy="45" r="6" fill="#ec4899"/>
      <circle cx="76" cy="42" r="6" fill="#ec4899"/>
      <circle cx="70" cy="56" r="6" fill="#ec4899"/>
    </g>
    <text x="50" y="73" text-anchor="middle" class="small-label">k clusters</text>
  </g>

  <path d="M 300 380 L 325 380" stroke="#3182ce" stroke-width="2" fill="none" marker-end="url(#arrow-star)"/>

  <!-- LLM -->
  <g transform="translate(335, 355)">
    <circle cx="30" cy="25" r="25" fill="#fef5e7" stroke="#f39c12" stroke-width="2"/>
    <text x="30" y="20" text-anchor="middle" style="font-size: 18px;">ðŸ§ </text>
    <text x="30" y="35" text-anchor="middle" class="small-label" font-weight="bold">CGQG</text>
  </g>

  <path d="M 395 380 L 420 380" stroke="#3182ce" stroke-width="2" fill="none" marker-end="url(#arrow-star)"/>

  <!-- Queries -->
  <g transform="translate(430, 360)">
    <rect x="0" y="0" width="50" height="40" rx="4" fill="#ebf8ff" stroke="#3182ce" stroke-width="1.5"/>
    <rect x="8" y="8" width="34" height="6" fill="#3182ce" opacity="0.6" rx="1"/>
    <rect x="8" y="17" width="34" height="6" fill="#3182ce" opacity="0.6" rx="1"/>
    <rect x="8" y="26" width="34" height="6" fill="#3182ce" opacity="0.6" rx="1"/>
  </g>

  <!-- Step 2: Dual Encoding -->
  <path d="M 265 430 L 265 455 L 510 455" stroke="#3182ce" stroke-width="1.5" stroke-dasharray="3,3" fill="none"/>
  <path d="M 455 410 L 455 455 L 510 455" stroke="#3182ce" stroke-width="1.5" stroke-dasharray="3,3" fill="none"/>

  <!-- Table Encoder -->
  <g transform="translate(515, 340)">
    <rect x="0" y="0" width="70" height="45" rx="5" fill="#fef5e7" stroke="#f39c12" stroke-width="2"/>
    <text x="35" y="14" text-anchor="middle" class="small-label">Encoder</text>
    <rect x="15" y="22" width="40" height="8" fill="#3182ce" opacity="0.3" rx="1"/>
    <text x="35" y="38" text-anchor="middle" class="small-label" font-weight="bold">E_t</text>
  </g>

  <!-- Query Encoder -->
  <g transform="translate(515, 400)">
    <rect x="0" y="0" width="70" height="45" rx="5" fill="#fef5e7" stroke="#f39c12" stroke-width="2"/>
    <text x="35" y="14" text-anchor="middle" class="small-label">Encoder</text>
    <rect x="15" y="22" width="40" height="8" fill="#3182ce" opacity="0.3" rx="1"/>
    <text x="35" y="38" text-anchor="middle" class="small-label" font-weight="bold">E_q</text>
  </g>

  <!-- Arrows to WF -->
  <path d="M 595 362 L 625 380" stroke="#3182ce" stroke-width="2" fill="none" marker-end="url(#arrow-star)"/>
  <path d="M 595 422 L 625 404" stroke="#3182ce" stroke-width="2" fill="none" marker-end="url(#arrow-star)"/>

  <!-- Weighted Fusion -->
  <g transform="translate(635, 360)">
    <rect x="0" y="0" width="90" height="65" rx="5" fill="#ebf8ff" stroke="#3182ce" stroke-width="2"/>
    <text x="45" y="15" text-anchor="middle" class="small-label">Weighted Fusion</text>

    <!-- Visual representation of weighted sum -->
    <circle cx="30" cy="35" r="8" fill="#3182ce" opacity="0.5"/>
    <text x="30" y="39" text-anchor="middle" style="font-size: 9px; fill: white; font-weight: bold;">t</text>

    <text x="45" y="40" text-anchor="middle" style="font-size: 16px; fill: #3182ce; font-weight: bold;">âŠ•</text>

    <circle cx="60" cy="35" r="8" fill="#3182ce" opacity="0.5"/>
    <text x="60" y="39" text-anchor="middle" style="font-size: 9px; fill: white; font-weight: bold;">q</text>

    <text x="45" y="56" text-anchor="middle" class="small-label">FWF/DWF</text>
  </g>

  <path d="M 735 392 L 760 392" stroke="#3182ce" stroke-width="2" fill="none" marker-end="url(#arrow-star)"/>

  <!-- Output -->
  <g transform="translate(770, 377)">
    <ellipse cx="40" cy="15" rx="40" ry="15" fill="#c6f6d5" stroke="#38a169" stroke-width="2"/>
    <text x="40" y="20" text-anchor="middle" class="small-label" font-weight="bold">E_table</text>
  </g>

  <!-- Legend -->
  <rect x="50" y="520" width="1000" height="60" rx="8" fill="#f7fafc" stroke="#cbd5e0" stroke-width="1"/>
  <text x="550" y="540" text-anchor="middle" class="label" font-weight="bold">Key Improvements</text>
  <text x="250" y="560" text-anchor="middle" class="small-label">â‘  Semantic Clustering vs. Heuristic Cut</text>
  <text x="550" y="560" text-anchor="middle" class="small-label">â‘¡ Cluster-Guided Query Generation</text>
  <text x="850" y="560" text-anchor="middle" class="small-label">â‘¢ Weighted Fusion vs. Simple Concat</text>

  <!-- Stage labels -->
  <text x="340" y="55" text-anchor="middle" class="small-label" font-style="italic" fill="#718096">Stage 1: Partial Table &amp; Query Generation</text>
  <text x="670" y="55" text-anchor="middle" class="small-label" font-style="italic" fill="#718096">Stage 2: Encoding &amp; Fusion</text>

  <line x1="490" y1="60" x2="490" y2="510" stroke="#e2e8f0" stroke-width="1" stroke-dasharray="5,5"/>

</svg>
